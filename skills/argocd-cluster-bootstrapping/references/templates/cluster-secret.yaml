# ArgoCD Cluster Secret Template
#
# This template creates a cluster secret that registers a Kubernetes cluster
# with ArgoCD. The labels are critical for ApplicationSet targeting.
#
# Usage:
#   1. Replace all <PLACEHOLDER> values
#   2. Save to: infra-team/argocd-clusters/<cluster-name>.yaml
#   3. Commit and push to Git repository
#
# Required replacements:
#   - <CLUSTER_NAME>: Developer-friendly name (e.g., cafehyna-dev)
#   - <ENVIRONMENT>: Environment tier (dev|hlg|prd|hub)
#   - <REGION>: Azure region code (e.g., brazilsouth, eastus2)
#   - <NODE_TYPE>: Node type (spot|standard|mixed)
#   - <CONNECTION_TYPE>: Network type (internal|external)
#   - <TIER>: Cluster tier (platform|application)
#   - <SERVER_URL>: Full Kubernetes API server URL
#   - <CA_DATA>: Base64-encoded CA certificate

apiVersion: v1
kind: Secret
metadata:
  name: <CLUSTER_NAME>
  namespace: argocd
  labels:
    # Required: Identifies this as a cluster secret
    argocd.argoproj.io/secret-type: cluster

    # Targeting labels (used by ApplicationSets)
    environment: <ENVIRONMENT>
    region: <REGION>
    cluster-name: <CLUSTER_NAME>
    node-type: <NODE_TYPE>
    connection-type: <CONNECTION_TYPE>
    tier: <TIER>

    # Optional: Additional metadata
    # business-unit: <BUSINESS_UNIT>
    # cost-center: <COST_CENTER>
    # owner: <TEAM_NAME>

type: Opaque
stringData:
  # Display name in ArgoCD UI
  name: <CLUSTER_NAME>

  # Kubernetes API server URL
  server: <SERVER_URL>

  # Authentication configuration
  config: |
    {
      "execProviderConfig": {
        "command": "argocd-k8s-auth",
        "args": ["azure", "--cluster-name", "<AKS_CLUSTER_NAME>"],
        "apiVersion": "client.authentication.k8s.io/v1beta1"
      },
      "tlsClientConfig": {
        "insecure": false,
        "caData": "<CA_DATA>"
      }
    }

---
# Example: Development Cluster (cafehyna-dev)
#
# apiVersion: v1
# kind: Secret
# metadata:
#   name: cafehyna-dev
#   namespace: argocd
#   labels:
#     argocd.argoproj.io/secret-type: cluster
#     environment: dev
#     region: brazilsouth
#     cluster-name: cafehyna-dev
#     node-type: spot
#     connection-type: internal
#     tier: application
#     business-unit: cafehyna
# type: Opaque
# stringData:
#   name: cafehyna-dev
#   server: https://aks-cafehyna-dev-abc123.hcp.brazilsouth.azmk8s.io:443
#   config: |
#     {
#       "execProviderConfig": {
#         "command": "argocd-k8s-auth",
#         "args": ["azure", "--cluster-name", "aks-cafehyna-dev"],
#         "apiVersion": "client.authentication.k8s.io/v1beta1"
#       },
#       "tlsClientConfig": {
#         "insecure": false,
#         "caData": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0t..."
#       }
#     }
